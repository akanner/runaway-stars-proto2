{% extends 'base.html.twig' %}
{% block stylesheets %}
    <style>
        label:before {
        background-color: white;
        color: white;
        content: " ";
        display: block;
        border-radius: 50%;
        border: 1px solid grey;
        position: absolute;
        top: -5px;
        left: -5px;
        width: 25px;
        height: 25px;
        text-align: center;
        line-height: 28px;
        transition-duration: 0.4s;
        transform: scale(0);
      }

      label img {
        transition-duration: 0.2s;
        transform-origin: 50% 50%;
      }

      :checked + label {
        border-color: #ddd;
      }

      :checked + label:before {
        content: "âœ“";
        background-color: green;
        transform: scale(1);
      }

            label {
        border: 1px solid #fff;
        padding: 10px;
        display: block;
        position: relative;
        margin: 10px;
        cursor: pointer;
      }

      :checked + label img {
        transform: scale(0.9);
        box-shadow: 0 0 5px #333;
      }

       body {
        padding-top: 70px;
      }
    </style>

{% endblock %}
{% block javascripts %}
<script src="js/lib.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.blockUI/2.70/jquery.blockUI.min.js"></script>
<script type="text/javascript">

    //delay de form submittion for 3 seconds and shows an animation
    $( "#runaway-stars-form" ).submit(function( event ) {
        //shows animation
        $.blockUI({ message: $('#throbber') });
        //delay for 3 seconds
        form = this;
       event.preventDefault();
       setTimeout( function () {
           form.submit();
       }, 2000);
    });
    //enables submit button
    $( "#answer-button" ).on( "click", function( event ) {
      //validates the form
      formSelector = "#runaway-stars-form";
      form          = $(formSelector);
      //don't ignore the hidden fields please!!
      $.validator.setDefaults({
          ignore: [],
      })
      //no messages are displayed
      form.validate({
          errorPlacement: function(error,element) {
            return true;
          }
        });
      if(!form.valid())
      {
        alert("Debe seleccionar al menos una imagen");
        return;
      }
      //shows answer and help text
      radioSelected    = $('input[name=answer]:checked', '#runaway-stars-form');
      starContainer    = radioSelected.parents('.star-container');
      showResponse(starContainer,isInTrainingMode());
      //enables submit button
      $("#submit-button").prop('disabled', false);
      $(this).prop('disabled',true);
      $(" input:radio").addClass('hidden');
      //adds points
      addPointsFor(starContainer);
    });
</script>

{% endblock %}
{% block body %}
    <div class="container-fluid">
        <div class="row" id="score-div">
            <div class="col-md-2">
                <h3>Pregunta <span id="current-task">{{current_step}}</span> de <span id="total-questions">{{max_step}}</span></h3>
            </div>
            <div class="col-md-2 col-md-offset-8">
                <h3>PUNTOS: <span id="score">{{points}}</span></h3>
            </div>
        </div>
        <form id="runaway-stars-form" class="well" action="{{post_url}}" method="POST">
            <div class="row">
                <h3 class="centered">&iquest;Podes Indicar la <i>Runaway Star</i>?</h3>
            </div>
            <div class="row">
                {% for img in images %}
                    <div class="star-container col-md-4 col-md-4">
                        <div class="row">
                            <div class="col-md-12">
                                 <input class="radio hidden" type="radio" name="answer" id="answerRadio{{img.id}}" required="required" value="{{img.id}}">
                                 <label for="answerRadio{{img.id}}"><img class="img-responsive" src="{{ absolute_url(img.path) }}"/></label>
                            </div>
                        </div>
                        <div class="row answer hidden">
                            <div class="col-md-4 col-md-offset-4">
                               <strong class="answerText {{img.cssClass}}">{{img.correctText}}</strong>
                               <p class="answerValue hidden">{{img.correct}}</p>
                           </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="row"><div class="col-md-12"></div></div>

            <div class="row">
                <div class="col-md-1 col-md-offset-10">
                    <button type="button" id="answer-button" class="btn btn-lg btn-primary">Contestar!</button>
                </div>
                <div class="col-md-1">
                    <button type="submit" id="submit-button" disabled="disabled" class="btn btn-lg btn-success">Siguiente</button>
                </div>
            </div>
        </form>
    </div>

    <!-- points -->
    <div class="hidden" id="div-points">
        <p id="correct-points">{{correct_points}}</p>
        <p id="inorrect-points">{{incorrect_points}}</p>
    </div>
    <div id="throbber" style="display:none;">
        {% image "@AppBundle/Resources/public/images/ajax-loader.gif" %}
            <img  src="{{ asset_url }}" alt="wait">
        {% endimage %}
    </div>

{% endblock %}
